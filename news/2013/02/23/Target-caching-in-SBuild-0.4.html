
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Target caching in SBuild 0.4 - SBuild</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The development of SBuild 0.4 is almost finished. SBuild 0.4.0 will provide a lot of new features. In this and some following post, I will dig a bit deeper into some of them. This todays post is about the caching mechanism and the"scan" target scheme...">
        <meta name="author" content="">
    <meta name="keywords" content="">

	<!-- TWitter card -->
	<meta name="twitter:card" content="summary">
	<meta name="twitter:site" content="@SBuildOrg">
	<meta name="twitter:creator" content="@TobiasRoeser">
	       	<meta name="twitter:title" content="Target caching in SBuild 0.4">
		  <meta name="twitter:description" content="The development of SBuild 0.4 is almost finished. SBuild 0.4.0 will provide a lot of new features. In this and some following post, I will dig a bit deeper into some of them. This todays post is about the caching mechanism and the"scan" target scheme...">
	  	

    <!-- Le styles -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/asciidoctor.css" rel="stylesheet">
    <link href="/css/base.css" rel="stylesheet">
    <link href="/css/font-awesome.min.css" rel="stylesheet">
    <link href="/css/bootstrap-responsive.min.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="/js/html5shiv.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="/assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="/favicon.ico">
  </head>
  <body>
    <div id="wrap">
	
	<!-- Fixed navbar -->
      <div class="navbar navbar-fixed-top">
        <div class="navbar-inner">
          <div class="container">
            <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="brand" href="/">SBuild</a>
			<form class="navbar-form navbar-search pull-right" action="http://www.google.com/search">
                    <input type="text" name="q" class="search-query input-medium" placeholder="Google Search" />
                    <input type="hidden" name="sitesearch" value="sbuild.org" />
            </form>
            <div class="nav-collapse collapse">
              <ul class="nav pull-right">
                <li class="dropdown"><a href="/news">News</a>
                  <ul class="dropdown-menu" role="menu">
                                            <li><a href="/news/2014/12/17/SBuild-0.7.7-About-Thread-Deadlock-fixes-and-parallel-ClassLoaders-in-Scala.html">SBuild 0.7.7 - About Thread Deadlock fixes and parallel ClassLoaders in Scala <small class="muted">- 17 December 2014</small></a></li>
                        <li><a href="/news/2014/05/31/SBuild-0.7.6-ScalaDays-Hackathon-Release.html">SBuild 0.7.6 - ScalaDays Hackathon Release <small class="muted">- 31 May 2014</small></a></li>
                        <li><a href="/news/2014/05/09/SBuild-Eclipse-Plugin-0.4.3-released.html">SBuild Eclipse Plugin 0.4.3 released <small class="muted">- 09 May 2014</small></a></li>
                        <li><a href="/news/2014/04/04/SBuild-0.7.5-released.html">SBuild 0.7.5 released <small class="muted">- 04 April 2014</small></a></li>
                        <li><a href="/news/2014/03/20/SBuild-0.7.4-released.html">SBuild 0.7.4 released <small class="muted">- 20 March 2014</small></a></li>
                    <li><a href="/news">older News...</a><li>
                  </ul>
                </li>
                <li class="dropdown"><a href="/doc/sbuild">Documentation</a>
                  <ul class="dropdown-menu" role="menu">
                    <li><a href="/doc/sbuild/0.7.7"><i class="icon-book"></i> SBuild Reference Manual <span class="muted">0.7.7</span></a></li>
                    <li><a href="http://sbuild.org/uploads/sbuild/0.7.7/scaladoc/de.tototec.sbuild/#de.tototec.sbuild.package"><i class="icon-file-text"></i> SBuild Core ScalaDoc <span class="muted">0.7.7</span></a></li>
                    <li><a href="/releases"><i class="icon-calendar"></i> Release History</a></li>
                    <li><a href="/faq"><i class="icon-question-sign"></i> FAQ</a></li>
                  </ul>
                </li>
                <li class="dropdown"><a href="/download">Download</a>
                  <ul class="dropdown-menu" role="menu">
                    <li><a href="http://sbuild.org/uploads/sbuild/0.7.7/sbuild-0.7.7-dist.zip"><i class="icon-download-alt"></i> SBuild 0.7.7 Distribution <small class="muted">- 2014-12-17</small></a></li>
                  </ul>
                </li>
                <li><a href="/plugins.html">Plugins</a></li>
                <li><a href="/eclipse">Eclipse</a></li>
                <li class="dropdown">
                    <a href="/community.html">Get Involved / Contact</a>
                   <ul class="dropdown-menu" role="menu">
                    <li><a href="https://github.com/SBuild-org/sbuild"><i class="icon-github"></i> GitHub</a></li>
                    <li><a href="https://twitter.com/SBuildOrg"><i class="icon-twitter"></i> Twitter <small class="muted">@SBuildOrg</small></a></li>
                    <li><a href="https://gitter.im/SBuild-org/sbuild" ><i class="icon-comments"></i> Gitter</li>
<!--                    <li><a href="http://webchat.freenode.net/?channels=%23sbuild" ><i class="icon-comments"></i> IRC <small class="muted">#sbuild</small></a></li>
-->
                    <li><a href="https://groups.google.com/forum/#!forum/sbuild-dev"><i class="icon-envelope"></i> Developers <small class="muted">sbuild-dev</small></a></li>
                    <li><a href="https://groups.google.com/forum/#!forum/sbuild-user"><i class="icon-envelope"></i> User Forum <small class="muted">sbuild-user</small></a></li>
                  </ul>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <div class="container">
	
	<div class="row">
	  <div class="span8">
	    <div class="page-header">
		  <h1>Target caching in SBuild 0.4</h1>
	    </div>

	    <p><em>23 February 2013 by Tobias Roeser</em></p>

		<p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The development of SBuild 0.4 is almost finished. <strong>SBuild 0.4.0</strong> will provide a lot of new features. In this and some following post, I will dig a bit deeper into some of them.</p>
</div>
<div class="paragraph">
<p>This todays post is about the new <strong>caching mechanism</strong> for phony targets and the new <strong>"scan" target scheme</strong> to collect files.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="background">Background</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SBuild already tries to reach a requested goal as fast as possible, but, of course, without sacrifying the correctness of the result.
Targets that don&#8217;t need to be executed will be skipped.
For file targets this is relatively easy, as the decission if a file target needs to be executed can be based on existence, and if, on the last modified attribute of the target file.
Only if the file is missing or older than at least one dependency, it will be rebuild.</p>
</div>
<div class="paragraph">
<p>Phony targets produce by-definition no single target file.
So, without further knowledge about the details of that target definition, SBuild is not able to skip the execution of phony targets, without risking the correctness of the build result.</p>
</div>
<div class="paragraph">
<p>But, as you already might have guessed, you can provide SBuild such information, so that it will be able to detect unnecessary executions of phony targets and thus will skip them.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cacheable_phony_targets">Cacheable phony targets</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can set the new <code>cacheable</code> property of a phony target, which will tell SBuild, that this target will only depend on the declared dependencies and the buildfile itselves.
Through the cacheable flag, you tell SBuild, that if all dependencies of that target and the aggregated last modified time stamp of them are identical to those of a previous execution, then that target might be skipped.
Whenever at least one dependency of that target changes, or an attached file (this is another new feature I will write about in a future post) or when the build file or any of its dependencies have changed, the cached state is dropped and the target will be executed.
The most typical target you want to be cached is the "compile" target.</p>
</div>
<div class="paragraph">
<p>Of course, with cacheable target you also need some manual way to drop caches and force re-execution of all cached targets.
To flag a target which should drop all cached states, you can set the <strong>evictCache</strong> property of that target.
This target is most typically the "clean" target.</p>
</div>
<div class="paragraph">
<p>Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint scala language-scala"><code>Target("phony:clean").evictCache exec {
  AntDelete(dir = Path("target"))
}

Target("phony:compile").cacheable dependsOn compileCp ~ "scan:src/main/scala" exec {
  // compile code ...omitted for brevity
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above shows a minimal but already complete example for a cached phony target.</p>
</div>
<div class="paragraph">
<p>As said above, to be correct when evaluating up-to-dateness, it is essential, that you declare <strong>all</strong> dependencies, which would influence the outcome of that target.
Because of that, the "compile" target above declares beside the compile classpath (compileCp) also all source files (in this example all files under the <code>src/main/scala</code> directory) as dependencies.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="scanning_for_files">Scanning for files</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To collect files you dont know beforehand, you can use the new "scan" target scheme (<code>ScanSchemeHandler</code>), which will scan a given directory for files matching a given pattern.
If no pattern is specified, all files will be attached and will be available throw the TargetContext of the target, that declared the dependency.</p>
</div>
<div class="paragraph">
<p>The following example shows the use of the scan target with a regex filter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint scala language-scala"><code>Target("phony:process-files") dependsOn "scan:src/main/resources;regex=.*\.conf" exec { ctx: TargetContext =&gt;
  ctx.fileTargets.map { file =&gt;
    // process file
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have many dependencies and need to selectively catch the scanned files, you can use the <code>TargetRef.files</code> method, like in this example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint scala language-scala"><code>val confFiles = "scan:src/main/resources;regex=.*\.conf"

Target("phony:process-files") dependsOn otherDependency ~ confFiles exec {
  confFiles.files.map { file =&gt;
    // process each .conf file found in src/main/resources
  }
  // do something with the other dependencies
  // otherDependencies.files.map { file =&gt; ... }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hope, you find this post useful.</p>
</div>
<div class="paragraph">
<p>Regards,<br>
Tobias Roeser</p>
</div>
</div>
</div></p>
		
		
	    <ul class="pager">
		    <li class="previous"><a href="/news/2013/01/26/SBuild-0.3.2-released.html">&larr; Older</a></li>
		    <li><a href="/news">List all news items</a></li>
		    <li class="next"><a href="/news/2013/03/07/Attached-Files-and-Alias-Schemes-in-SBuild-0.4.html">Newer &rarr;</a></li>
		</ul>
	    
	        <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'sbuild'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
      </div>
      <div class="span4">
	    <h1><small>Recent News</small></h1>
	    
			<h3><small>December 2014</small></h3>
			<ul>
		
		<li>17 - <a href="/news/2014/12/17/SBuild-0.7.7-About-Thread-Deadlock-fixes-and-parallel-ClassLoaders-in-Scala.html">SBuild 0.7.7 - About Thread Deadlock fixes and parallel ClassLoaders in Scala</a></li>
				</ul>
				<h3><small>May 2014</small></h3>
				<ul>
		
		<li>31 - <a href="/news/2014/05/31/SBuild-0.7.6-ScalaDays-Hackathon-Release.html">SBuild 0.7.6 - ScalaDays Hackathon Release</a></li>
		
		<li>09 - <a href="/news/2014/05/09/SBuild-Eclipse-Plugin-0.4.3-released.html">SBuild Eclipse Plugin 0.4.3 released</a></li>
				</ul>
				<h3><small>April 2014</small></h3>
				<ul>
		
		<li>04 - <a href="/news/2014/04/04/SBuild-0.7.5-released.html">SBuild 0.7.5 released</a></li>
				</ul>
				<h3><small>March 2014</small></h3>
				<ul>
		
		<li>20 - <a href="/news/2014/03/20/SBuild-0.7.4-released.html">SBuild 0.7.4 released</a></li>
		
		<li>18 - <a href="/news/2014/03/18/SBuild-0.7.3-released.html">SBuild 0.7.3 released</a></li>
		
		<li>06 - <a href="/news/2014/03/06/SBuild-0.7.2-released.html">SBuild 0.7.2 released</a></li>
				</ul>
				<h3><small>February 2014</small></h3>
				<ul>
		
		<li>11 - <a href="/news/2014/02/11/Issue-Tracker-moved-to-GitHub.html">Issue Tracker moved to GitHub</a></li>
				</ul>
				<h3><small>December 2013</small></h3>
				<ul>
		
		<li>20 - <a href="/news/2013/12/20/SBuild-0.7.1-released.html">SBuild 0.7.1 released</a></li>
		
		<li>20 - <a href="/news/2013/12/20/The-Plugin-System-of-SBuild-0.7.1.html">The Plugin System of SBuild 0.7.1</a></li>
		
		<li>06 - <a href="/news/2013/12/06/Jenkins-Plugin-for-SBuild-available.html">Jenkins Plugin for SBuild available</a></li>
		
		<li>06 - <a href="/news/2013/12/06/SBuild-0.7.0-released.html">SBuild 0.7.0 released</a></li>
		
		<li>06 - <a href="/news/2013/12/06/The-Plugin-System-of-SBuild-0.7.0.html">The Plugin System of SBuild 0.7.0</a></li>
		
		<li>03 - <a href="/news/2013/12/03/All-SBuild-repositories-are-now-hosted-on-GitHub.html">All SBuild repositories are now hosted on GitHub</a></li>
				</ul>
				<h3><small>November 2013</small></h3>
				<ul>
		
		<li>21 - <a href="/news/2013/11/21/SBuild-switched-to-Git.html">SBuild switched to Git</a></li>
				</ul>
				<h3><small>September 2013</small></h3>
				<ul>
		
		<li>19 - <a href="/news/2013/09/19/SBuild-0.6.0-released.html">SBuild 0.6.0 released</a></li>
				</ul>
				<h3><small>July 2013</small></h3>
				<ul>
		
		<li>12 - <a href="/news/2013/07/12/SBuild-0.5.0-New-and-Noteworthy.html">New and Noteworthy of SBuild 0.5.0</a></li>
		
		<li>12 - <a href="/news/2013/07/12/SBuild-0.5.0-Released.html">SBuild 0.5.0 Released</a></li>
				</ul>
				<h3><small>April 2013</small></h3>
				<ul>
		
		<li>29 - <a href="/news/2013/04/29/SBuild-Eclipse-Plugin-0.4.1.html">SBuild Eclipse Plugin 0.4.1</a></li>
		
		<li>20 - <a href="/news/2013/04/20/SBuild-Eclipse-Plugin-0.4.0-Hackathon-Release.html">SBuild Eclipse Plugin 0.4.0 - Hackathon Release</a></li>
				</ul>
				<h3><small>March 2013</small></h3>
				<ul>
		
		<li>11 - <a href="/news/2013/03/11/SBuild-0.4.0-Released.html">SBuild 0.4.0 Released</a></li>
		
		<li>07 - <a href="/news/2013/03/07/Attached-Files-and-Alias-Schemes-in-SBuild-0.4.html">Attached Files and Alias Schemes in SBuild 0.4</a></li>
				</ul>
				<h3><small>February 2013</small></h3>
				<ul>
		
		<li>23 - <a href="/news/2013/02/23/Target-caching-in-SBuild-0.4.html">Target caching in SBuild 0.4</a></li>
				</ul>
				<h3><small>January 2013</small></h3>
				<ul>
		
		<li>26 - <a href="/news/2013/01/26/SBuild-0.3.2-released.html">SBuild 0.3.2 released</a></li>
				</ul>
				<h3><small>November 2012</small></h3>
				<ul>
		
		<li>27 - <a href="/news/2012/11/27/Natures-Experimental-high-level-abstraction-for-builds.html">Natures - Experimental high level abstraction for builds</a></li>
				</ul>
				<h3><small>October 2012</small></h3>
				<ul>
		
		<li>31 - <a href="/news/2012/10/31/SBuild-Eclipse-Plugin-0.2.0.html">SBuild Eclipse Plugin 0.2.0</a></li>
		
		<li>29 - <a href="/news/2012/10/29/SBuild-Eclipse-Plugin-0.2.0-release-comming-soon.html">SBuild Eclipse Plugin 0.2.0 release comming soon</a></li>
		
		<li>23 - <a href="/news/2012/10/23/Managing-Eclipse-Build-Path-Entries-with-SBuild.html">Managing Eclipse Build Path Entries with SBuild</a></li>
				</ul>
				<h3><small>September 2012</small></h3>
				<ul>
		
		<li>26 - <a href="/news/2012/09/26/SBuild-0.1.1-Released.html">SBuild 0.1.1 Released</a></li>
				</ul>
				<h3><small>July 2012</small></h3>
				<ul>
		
		<li>29 - <a href="/news/2012/07/29/SBuild-0.1.0-First-Public-Release.html">SBuild 0.1.0 First Public Release</a></li>
		
		<li>12 - <a href="/news/2012/07/12/Preparations-for-first-release.html">Preparations for first release</a></li>
	    
	    </ul>
	    
	  </div>

	<hr>
	
		</div>
		<div id="push"></div>
    </div>
    
    
    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/js/jquery-1.9.1.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/run_prettify.js"></script>
    
  </body>
</html>